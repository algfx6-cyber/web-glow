<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chroma - Interactive Color Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
            overflow-x: hidden;
        }

        /* Custom Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            margin-top: -8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
        }
        
        /* Color Picker Override */
        input[type="color"] {
            -webkit-appearance: none;
            border: none;
            width: 100%;
            height: 100%;
            cursor: pointer;
            background: none;
        }
        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0; 
        }
        input[type="color"]::-webkit-color-swatch {
            border: none;
            border-radius: 0.75rem;
        }

        /* Glassmorphism */
        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Animations */
        @keyframes popIn {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .color-swatch {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .color-swatch:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #334155; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569; 
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Navigation / Header -->
    <nav class="w-full glass fixed top-0 z-50 px-6 py-4 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-pink-500 via-red-500 to-yellow-500 animate-pulse"></div>
            <h1 class="text-2xl font-bold tracking-tight text-white">Chroma<span class="text-indigo-400">Studio</span></h1>
        </div>
        <div class="hidden md:flex gap-6 text-sm font-medium text-slate-400">
            <button onclick="app.generatePalette()" class="hover:text-white transition-colors flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                Randomize
            </button>
            <button onclick="app.exportCSS()" class="hover:text-white transition-colors flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                Copy CSS
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow pt-24 pb-12 px-4 md:px-8 max-w-7xl mx-auto w-full grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- Left Column: Controls & Picker -->
        <section class="lg:col-span-4 flex flex-col gap-6">
            
            <!-- Main Color Picker Card -->
            <div class="glass rounded-2xl p-6 shadow-2xl relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                    <svg class="w-32 h-32" fill="currentColor" viewBox="0 0 24 24"><path d="M12 22C6.49 22 2 17.51 2 12S6.49 2 12 2s10 4.04 10 9c0 3.31-2.69 6-6 6h-1.77c-.28 0-.5.22-.5.5 0 .12.05.23.13.33.41.47.64 1.06.64 1.67A2.5 2.5 0 0112 22zm0-18c-4.41 0-8 3.59-8 8s3.59 8 8 8c.28 0 .5-.22.5-.5a.54.54 0 00-.14-.35c-.41-.46-.63-1.05-.63-1.65a2.5 2.5 0 012.5-2.5H16c2.21 0 4-1.79 4-4 0-3.86-3.59-7-8-7z"/><circle cx="6.5" cy="11.5" r="1.5"/><circle cx="9.5" cy="7.5" r="1.5"/><circle cx="14.5" cy="7.5" r="1.5"/><circle cx="17.5" cy="11.5" r="1.5"/></svg>
                </div>

                <h2 class="text-lg font-semibold mb-4 text-slate-200">Base Color</h2>
                
                <div class="flex gap-4 mb-6">
                    <div class="w-24 h-24 rounded-xl shadow-inner border border-slate-600 overflow-hidden relative">
                        <input type="color" id="nativeColorPicker" value="#6366f1" class="absolute inset-0 w-[150%] h-[150%] -top-1/4 -left-1/4 p-0 border-0">
                    </div>
                    <div class="flex-1 flex flex-col justify-center gap-2">
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 font-mono">#</span>
                            <input type="text" id="hexInput" value="6366F1" maxlength="6" class="w-full bg-slate-800 border border-slate-600 rounded-lg py-2 pl-7 pr-3 text-white font-mono focus:outline-none focus:border-indigo-500 transition-colors uppercase">
                        </div>
                        <div class="text-xs text-slate-400 font-mono" id="rgbDisplay">rgb(99, 102, 241)</div>
                    </div>
                </div>

                <!-- Sliders -->
                <div class="space-y-5">
                    <div>
                        <div class="flex justify-between text-xs font-medium text-slate-400 mb-2">
                            <span>HUE</span>
                            <span id="hueVal">240°</span>
                        </div>
                        <input type="range" id="hueSlider" min="0" max="360" value="240" class="w-full h-2 rounded-lg appearance-none cursor-pointer" style="background: linear-gradient(to right, #f00 0%, #ff0 17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);">
                    </div>
                    
                    <div>
                        <div class="flex justify-between text-xs font-medium text-slate-400 mb-2">
                            <span>SATURATION</span>
                            <span id="satVal">80%</span>
                        </div>
                        <input type="range" id="satSlider" min="0" max="100" value="80" class="w-full h-2 rounded-lg appearance-none cursor-pointer bg-slate-700">
                    </div>

                    <div>
                        <div class="flex justify-between text-xs font-medium text-slate-400 mb-2">
                            <span>LIGHTNESS</span>
                            <span id="lightVal">60%</span>
                        </div>
                        <input type="range" id="lightSlider" min="0" max="100" value="60" class="w-full h-2 rounded-lg appearance-none cursor-pointer bg-slate-700">
                    </div>
                </div>
            </div>

            <!-- Contrast Checker -->
            <div class="glass rounded-2xl p-6">
                <h2 class="text-lg font-semibold mb-4 text-slate-200">Accessibility Check</h2>
                <div class="flex gap-4 mb-4">
                    <div class="flex-1">
                        <label class="text-xs text-slate-400 block mb-1">Text</label>
                        <div class="h-10 rounded-lg border border-slate-600 flex items-center justify-center font-bold cursor-pointer relative overflow-hidden" id="contrastTextBox" onclick="app.swapContrastColors()">
                            <span id="contrastTextHex">#FFFFFF</span>
                            <input type="color" id="contrastTextPicker" class="absolute inset-0 opacity-0 cursor-pointer">
                        </div>
                    </div>
                    <div class="flex-1">
                        <label class="text-xs text-slate-400 block mb-1">Background</label>
                        <div class="h-10 rounded-lg border border-slate-600 flex items-center justify-center font-bold cursor-pointer relative overflow-hidden" id="contrastBgBox">
                            <span id="contrastBgHex">#6366F1</span>
                            <input type="color" id="contrastBgPicker" class="absolute inset-0 opacity-0 cursor-pointer">
                        </div>
                    </div>
                </div>
                <div class="flex items-center justify-between bg-slate-800/50 rounded-lg p-3">
                    <div class="text-sm">
                        <div class="font-bold text-white text-lg" id="contrastRatio">4.5 : 1</div>
                        <div class="text-xs text-slate-400">Contrast Ratio</div>
                    </div>
                    <div class="flex gap-2">
                        <div id="badge-aa" class="px-2 py-1 rounded bg-green-500/20 text-green-400 text-xs font-bold border border-green-500/30">AA</div>
                        <div id="badge-aaa" class="px-2 py-1 rounded bg-slate-700 text-slate-400 text-xs font-bold border border-slate-600">AAA</div>
                    </div>
                </div>
            </div>

        </section>

        <!-- Right Column: Palette & Shades -->
        <section class="lg:col-span-8 flex flex-col gap-6">
            
            <!-- Generated Palette -->
            <div class="glass rounded-2xl p-6 min-h-[300px] flex flex-col">
                <div class="flex justify-between items-end mb-6">
                    <h2 class="text-xl font-bold text-white">Harmony Palette</h2>
                    <div class="flex bg-slate-800 rounded-lg p-1">
                        <button onclick="app.setHarmony('analogous')" class="harmony-btn px-3 py-1 text-xs font-medium rounded-md bg-slate-700 text-white shadow-sm transition-all" data-type="analogous">Analogous</button>
                        <button onclick="app.setHarmony('monochromatic')" class="harmony-btn px-3 py-1 text-xs font-medium rounded-md text-slate-400 hover:text-white transition-all" data-type="monochromatic">Mono</button>
                        <button onclick="app.setHarmony('triadic')" class="harmony-btn px-3 py-1 text-xs font-medium rounded-md text-slate-400 hover:text-white transition-all" data-type="triadic">Triadic</button>
                        <button onclick="app.setHarmony('complementary')" class="harmony-btn px-3 py-1 text-xs font-medium rounded-md text-slate-400 hover:text-white transition-all" data-type="complementary">Comp</button>
                    </div>
                </div>
                
                <div id="paletteContainer" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 flex-grow">
                    <!-- Palette items injected via JS -->
                </div>
            </div>

            <!-- Shades & Tints -->
            <div class="glass rounded-2xl p-6">
                <h2 class="text-xl font-bold text-white mb-6">Shades & Tints</h2>
                <div class="space-y-4" id="shadesContainer">
                    <!-- Shades injected via JS -->
                </div>
            </div>

            <!-- CSS Output Preview -->
            <div class="glass rounded-2xl p-6 bg-slate-900/80">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-sm font-semibold text-slate-400 uppercase tracking-wider">CSS Variables</h2>
                    <button onclick="app.copyCSS()" class="text-xs text-indigo-400 hover:text-indigo-300 font-medium">Copy to Clipboard</button>
                </div>
                <pre class="font-mono text-sm text-slate-300 bg-slate-950 p-4 rounded-lg overflow-x-auto border border-slate-800" id="cssOutput">
:root {
  --color-primary: #6366f1;
  --color-secondary: #818cf8;
  --color-accent: #4f46e5;
}
                </pre>
            </div>

        </section>
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl border border-slate-700 transform translate-y-20 opacity-0 transition-all duration-300 z-50 flex items-center gap-2">
        <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
        <span id="toastMsg">Copied to clipboard!</span>
    </div>

    <script>
        /**
         * ChromaStudio Logic
         * Handles color conversion, harmony generation, and UI state.
         */
        class ColorApp {
            constructor() {
                // State
                this.state = {
                    h: 239,
                    s: 84,
                    l: 67,
                    hex: '#6366f1',
                    harmony: 'analogous',
                    contrast: {
                        text: '#ffffff',
                        bg: '#6366f1'
                    }
                };

                // DOM Elements
                this.els = {
                    nativePicker: document.getElementById('nativeColorPicker'),
                    hexInput: document.getElementById('hexInput'),
                    rgbDisplay: document.getElementById('rgbDisplay'),
                    hueSlider: document.getElementById('hueSlider'),
                    satSlider: document.getElementById('satSlider'),
                    lightSlider: document.getElementById('lightSlider'),
                    hueVal: document.getElementById('hueVal'),
                    satVal: document.getElementById('satVal'),
                    lightVal: document.getElementById('lightVal'),
                    paletteContainer: document.getElementById('paletteContainer'),
                    shadesContainer: document.getElementById('shadesContainer'),
                    cssOutput: document.getElementById('cssOutput'),
                    // Contrast
                    contrastTextBox: document.getElementById('contrastTextBox'),
                    contrastBgBox: document.getElementById('contrastBgBox'),
                    contrastTextPicker: document.getElementById('contrastTextPicker'),
                    contrastBgPicker: document.getElementById('contrastBgPicker'),
                    contrastTextHex: document.getElementById('contrastTextHex'),
                    contrastBgHex: document.getElementById('contrastBgHex'),
                    contrastRatio: document.getElementById('contrastRatio'),
                    badgeAA: document.getElementById('badge-aa'),
                    badgeAAA: document.getElementById('badge-aaa'),
                    toast: document.getElementById('toast'),
                    toastMsg: document.getElementById('toastMsg')
                };

                this.init();
            }

            init() {
                // Event Listeners
                this.els.nativePicker.addEventListener('input', (e) => this.setFromHex(e.target.value));
                this.els.hexInput.addEventListener('input', (e) => this.setFromHex(e.target.value));
                
                this.els.hueSlider.addEventListener('input', (e) => this.setFromHSL({h: parseInt(e.target.value)}));
                this.els.satSlider.addEventListener('input', (e) => this.setFromHSL({s: parseInt(e.target.value)}));
                this.els.lightSlider.addEventListener('input', (e) => this.setFromHSL({l: parseInt(e.target.value)}));

                // Contrast Listeners
                this.els.contrastTextPicker.addEventListener('input', (e) => {
                    this.state.contrast.text = e.target.value;
                    this.updateContrastUI();
                });
                this.els.contrastBgPicker.addEventListener('input', (e) => {
                    // If user changes bg picker manually, we might want to decouple it from main state or sync it?
                    // For now, let's just update the checker. 
                    // Actually, let's make the background picker reflect the main color usually, 
                    // but allow override. Let's keep it simple: it reflects main color unless clicked?
                    // No, let's make the BG picker update the main color state to keep things synced.
                    this.setFromHex(e.target.value);
                });

                // Initial Render
                this.updateUI();
                this.generatePalette();
            }

            // --- Core Logic ---

            setFromHex(hex) {
                if (!/^#?[0-9A-F]{6}$/i.test(hex)) return;
                if (hex.startsWith('#')) hex = hex.substring(1);
                
                const hsl = this.hexToHsl(hex);
                this.state.h = hsl.h;
                this.state.s = hsl.s;
                this.state.l = hsl.l;
                this.state.hex = '#' + hex;
                
                // Sync contrast bg to main color
                this.state.contrast.bg = this.state.hex;
                
                this.updateUI();
                this.generatePalette();
            }

            setFromHSL(updates) {
                Object.assign(this.state, updates);
                this.state.hex = this.hslToHex(this.state.h, this.state.s, this.state.l);
                this.state.contrast.bg = this.state.hex;
                this.updateUI();
                this.generatePalette();
            }

            setHarmony(type) {
                this.state.harmony = type;
                
                // Update buttons
                document.querySelectorAll('.harmony-btn').forEach(btn => {
                    if(btn.dataset.type === type) {
                        btn.classList.remove('text-slate-400', 'bg-transparent');
                        btn.classList.add('bg-slate-700', 'text-white', 'shadow-sm');
                    } else {
                        btn.classList.add('text-slate-400', 'bg-transparent');
                        btn.classList.remove('bg-slate-700', 'text-white', 'shadow-sm');
                    }
                });

                this.generatePalette();
            }

            generatePalette() {
                const colors = [];
                const { h, s, l } = this.state;

                switch(this.state.harmony) {
                    case 'analogous':
                        colors.push(this.getHslString((h - 30 + 360) % 360, s, l));
                        colors.push(this.getHslString((h - 15 + 360) % 360, s, l));
                        colors.push(this.getHslString(h, s, l)); // Base
                        colors.push(this.getHslString((h + 15) % 360, s, l));
                        colors.push(this.getHslString((h + 30) % 360, s, l));
                        break;
                    case 'monochromatic':
                        colors.push(this.getHslString(h, s, Math.max(0, l - 40)));
                        colors.push(this.getHslString(h, s, Math.max(0, l - 20)));
                        colors.push(this.getHslString(h, s, l));
                        colors.push(this.getHslString(h, s, Math.min(100, l + 20)));
                        colors.push(this.getHslString(h, s, Math.min(100, l + 40)));
                        break;
                    case 'triadic':
                        colors.push(this.getHslString(h, s, l));
                        colors.push(this.getHslString((h + 120) % 360, s, l));
                        colors.push(this.getHslString((h + 240) % 360, s, l));
                        // Add lighter versions of triadic to fill 5 slots
                        colors.push(this.getHslString((h + 120) % 360, s, Math.min(100, l + 20)));
                        colors.push(this.getHslString((h + 240) % 360, s, Math.min(100, l + 20)));
                        break;
                    case 'complementary':
                        colors.push(this.getHslString(h, s, l));
                        colors.push(this.getHslString((h + 180) % 360, s, l));
                        colors.push(this.getHslString(h, Math.max(0, s - 20), Math.min(100, l + 10))); // Softer base
                        colors.push(this.getHslString((h + 180) % 360, Math.max(0, s - 20), Math.max(0, l - 10))); // Softer comp
                        colors.push(this.getHslString((h + 180) % 360, s, Math.min(100, l + 30))); // Light comp
                        break;
                }

                this.renderPalette(colors);
                this.renderShades();
                this.updateCSSOutput(colors);
            }

            renderPalette(colors) {
                this.els.paletteContainer.innerHTML = '';
                colors.forEach((color, index) => {
                    const hex = this.hslStringToHex(color);
                    const isLight = this.isLight(hex);
                    
                    const div = document.createElement('div');
                    div.className = 'color-swatch h-32 rounded-xl relative group cursor-pointer animate-pop flex flex-col justify-end p-3 overflow-hidden';
                    div.style.backgroundColor = color;
                    div.style.animationDelay = `${index * 50}ms`;
                    
                    div.innerHTML = `
                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"></div>
                        <div class="transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300">
                            <p class="font-mono text-xs font-bold ${isLight ? 'text-slate-800' : 'text-white'} opacity-80 uppercase">${hex}</p>
                        </div>
                        <button class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity bg-white/20 hover:bg-white/40 backdrop-blur-sm p-1.5 rounded-lg text-white" onclick="app.copyToClipboard('${hex}')">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                        </button>
                    `;
                    div.onclick = (e) => {
                        // Prevent triggering if copy button clicked
                        if(!e.target.closest('button')) {
                            this.setFromHex(hex);
                        }
                    };
                    this.els.paletteContainer.appendChild(div);
                });
            }

            renderShades() {
                this.els.shadesContainer.innerHTML = '';
                const steps = [95, 85, 75, 65, 55, 45, 35, 25, 15, 5]; // Lightness values
                
                const row = document.createElement('div');
                row.className = 'flex w-full h-16 rounded-xl overflow-hidden';
                
                steps.forEach(l => {
                    const color = this.getHslString(this.state.h, this.state.s, l);
                    const hex = this.hslStringToHex(color);
                    const div = document.createElement('div');
                    div.className = 'flex-1 h-full cursor-pointer hover:flex-[1.5] transition-all duration-300 relative group';
                    div.style.backgroundColor = color;
                    div.onclick = () => this.copyToClipboard(hex);
                    
                    div.innerHTML = `
                        <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                            <span class="text-[10px] font-mono font-bold ${l > 50 ? 'text-black' : 'text-white'}">${hex}</span>
                        </div>
                    `;
                    row.appendChild(div);
                });
                
                this.els.shadesContainer.appendChild(row);
            }

            updateCSSOutput(paletteColors) {
                const vars = paletteColors.map((c, i) => `  --color-${i + 1}: ${this.hslStringToHex(c)};`).join('\n');
                this.els.cssOutput.textContent = `:root {\n${vars}\n}`;
            }

            updateUI() {
                const { h, s, l, hex } = this.state;
                const rgb = this.hslToRgb(h, s, l);

                // Update Inputs
                this.els.nativePicker.value = hex;
                this.els.hexInput.value = hex.replace('#', '');
                this.els.rgbDisplay.textContent = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
                
                // Update Sliders
                this.els.hueSlider.value = h;
                this.els.satSlider.value = s;
                this.els.lightSlider.value = l;
                
                // Update Slider Labels
                this.els.hueVal.textContent = `${h}°`;
                this.els.satVal.textContent = `${s}%`;
                this.els.lightVal.textContent = `${l}%`;

                // Update Slider Backgrounds
                this.els.satSlider.style.background = `linear-gradient(to right, hsl(${h}, 0%, ${l}%), hsl(${h}, 100%, ${l}%))`;
                this.els.lightSlider.style.background = `linear-gradient(to right, hsl(${h}, ${s}%, 0%), hsl(${h}, ${s}%, 50%), hsl(${h}, ${s}%, 100%))`;

                // Update Contrast
                this.updateContrastUI();
            }

            updateContrastUI() {
                const { text, bg } = this.state.contrast;
                
                this.els.contrastTextBox.style.backgroundColor = text;
                this.els.contrastTextBox.style.color = this.isLight(text) ? '#000' : '#fff';
                this.els.contrastTextHex.textContent = text.toUpperCase();
                this.els.contrastTextPicker.value = text;

                this.els.contrastBgBox.style.backgroundColor = bg;
                this.els.contrastBgBox.style.color = this.isLight(bg) ? '#000' : '#fff';
                this.els.contrastBgHex.textContent = bg.toUpperCase();
                this.els.contrastBgPicker.value = bg;

                // Calculate Ratio
                const ratio = this.getContrastRatio(text, bg);
                this.els.contrastRatio.textContent = ratio + ' : 1';

                // Update Badges
                if (ratio >= 4.5) {
                    this.els.badgeAA.className = 'px-2 py-1 rounded bg-green-500/20 text-green-400 text-xs font-bold border border-green-500/30';
                } else {
                    this.els.badgeAA.className = 'px-2 py-1 rounded bg-red-500/20 text-red-400 text-xs font-bold border border-red-500/30';
                }

                if (ratio >= 7) {
                    this.els.badgeAAA.className = 'px-2 py-1 rounded bg-green-500/20 text-green-400 text-xs font-bold border border-green-500/30';
                } else {
                    this.els.badgeAAA.className = 'px-2 py-1 rounded bg-slate-700 text-slate-400 text-xs font-bold border border-slate-600';
                }
            }

            swapContrastColors() {
                const temp = this.state.contrast.text;
                this.state.contrast.text = this.state.contrast.bg;
                this.state.contrast.bg = temp;
                this.updateContrastUI();
            }

            // --- Utilities ---

            generateRandom() {
                const r = Math.floor(Math.random() * 255);
                const g = Math.floor(Math.random() * 255);
                const b = Math.floor(Math.random() * 255);
                const hex = "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
                this.setFromHex(hex);
            }

            copyToClipboard(text) {
                navigator.clipboard.writeText(text).then(() => {
                    this.showToast(`Copied ${text}`);
                });
            }

            copyCSS() {
                const code = this.els.cssOutput.textContent;
                navigator.clipboard.writeText(code).then(() => {
                    this.showToast('CSS Variables Copied!');
                });
            }

            exportCSS() {
                this.copyCSS();
            }

            showToast(msg) {
                this.els.toastMsg.textContent = msg;
                this.els.toast.classList.remove('translate-y-20', 'opacity-0');
                setTimeout(() => {
                    this.els.toast.classList.add('translate-y-20', 'opacity-0');
                }, 2000);
            }

            // --- Math Helpers ---

            getHslString(h, s, l) {
                return `hsl(${Math.round(h)}, ${Math.round(s)}%, ${Math.round(l)}%)`;
            }

            hslStringToHex(hslStr) {
                // Extract numbers from hsl string
                const [h, s, l] = hslStr.match(/\d+/g).map(Number);
                return this.hslToHex(h, s, l);
            }

            hslToHex(h, s, l) {
                l /= 100;
                const a = s * Math.min(l, 1 - l) / 100;
                const f = n => {
                    const k = (n + h / 30) % 12;
                    const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
                    return Math.round(255 * color).toString(16).padStart(2, '0');
                };
                return `#${f(0)}${f(8)}${f(4)}`.toUpperCase();
            }

            hexToHsl(hex) {
                let r = 0, g = 0, b = 0;
                if (hex.length === 4) {
                    r = "0x" + hex[1] + hex[1];
                    g = "0x" + hex[2] + hex[2];
                    b = "0x" + hex[3] + hex[3];
                } else if (hex.length === 7) {
                    r = "0x" + hex[1] + hex[2];
                    g = "0x" + hex[3] + hex[4];
                    b = "0x" + hex[5] + hex[6];
                }
                r /= 255; g /= 255; b /= 255;
                let cmin = Math.min(r,g,b), cmax = Math.max(r,g,b), delta = cmax - cmin;
                let h = 0, s = 0, l = 0;

                if (delta === 0) h = 0;
                else if (cmax === r) h = ((g - b) / delta) % 6;
                else if (cmax === g) h = (b - r) / delta + 2;
                else h = (r - g) / delta + 4;

                h = Math.round(h * 60);
                if (h < 0) h += 360;

                l = (cmax + cmin) / 2;
                s = delta === 0 ? 0 : delta / (1 - Math.abs(2 * l - 1));
                s = +(s * 100).toFixed(1);
                l = +(l * 100).toFixed(1);

                return { h, s, l };
            }

            hslToRgb(h, s, l) {
                s /= 100;
                l /= 100;
                let c = (1 - Math.abs(2 * l - 1)) * s,
                    x = c * (1 - Math.abs(((h / 60) % 2) - 1)),
                    m = l - c / 2,
                    r = 0, g = 0, b = 0;

                if (0 <= h && h < 60) { r = c; g = x; b = 0; }
                else if (60 <= h && h < 120) { r = x; g = c; b = 0; }
                else if (120 <= h && h < 180) { r = 0; g = c; b = x; }
                else if (180 <= h && h < 240) { r = 0; g = x; b = c; }
                else if (240 <= h && h < 300) { r = x; g = 0; b = c; }
                else if (300 <= h && h < 360) { r = c; g = 0; b = x; }

                return {
                    r: Math.round((r + m) * 255),
                    g: Math.round((g + m) * 255),
                    b: Math.round((b + m) * 255)
                };
            }

            isLight(color) {
                const hex = color.replace('#', '');
                const r = parseInt(hex.substr(0, 2), 16);
                const g = parseInt(hex.substr(2, 2), 16);
                const b = parseInt(hex.substr(4, 2), 16);
                const brightness = ((r * 299) + (g * 587) + (b * 114)) / 1000;
                return brightness > 155;
            }

            getLuminance(r, g, b) {
                var a = [r, g, b].map(function (v) {
                    v /= 255;
                    return v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);
                });
                return a[0] * 0.2126 + a[1] * 0.7152 + a[2] * 0.0722;
            }

            getContrastRatio(hex1, hex2) {
                const rgb1 = this.hexToRgb(hex1);
                const rgb2 = this.hexToRgb(hex2);
                const lum1 = this.getLuminance(rgb1.r, rgb1.g, rgb1.b);
                const lum2 = this.getLuminance(rgb2.r, rgb2.g, rgb2.b);
                const brightest = Math.max(lum1, lum2);
                const darkest = Math.min(lum1, lum2);
                return ((brightest + 0.05) / (darkest + 0.05)).toFixed(2);
            }

            hexToRgb(hex) {
                const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                return result ? {
                    r: parseInt(result[1], 16),
                    g: parseInt(result[2], 16),
                    b: parseInt(result[3], 16)
                } : null;
            }
        }

        // Initialize App
        const app = new ColorApp();
    </script>
</body>
</html>